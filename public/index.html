</html>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Leabharlann Ghealach Home</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="content" class="container-fluid">
    <div class="row">
      <div class="col-md-4">
        <div class="d-flex justify-content-between align-items-center">
          <h2 class="section-title">Authors</h2>
          <a href="create.html?type=Author" class="btn btn-sm btn-primary create-btn" style="display: none;">+</a>
        </div>
        <ul id="authors-list" class="node-list"></ul>
      </div>
      <div class="col-md-4">
        <div class="d-flex justify-content-between align-items-center">
          <h2 class="section-title">Texts</h2>
          <a href="create.html?type=Text" class="btn btn-sm btn-primary create-btn" style="display: none;">+</a>
        </div>
        <ul id="texts-list" class="node-list"></ul>
      </div>
      <div class="col-md-4">
        <div class="d-flex justify-content-between align-items-center">
          <h2 class="section-title">Editions</h2>
          <a href="create.html?type=Edition" class="btn btn-sm btn-primary create-btn" style="display: none;">+</a>
        </div>
        <ul id="editions-list" class="node-list"></ul>
      </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
  <script src="partials/insertHeader.js"></script>
  <script>
  const API_BASE = 'https://an-leabharlann-ghealach.onrender.com';

  function populateList(containerId, items, type, labelKey) {
    const ul = document.getElementById(containerId);
    ul.innerHTML = '';
    items.forEach(item => {
      const li = document.createElement('li');
      const a = document.createElement('a');
      const label = item.properties[labelKey] || item.id;
      a.textContent = label;
      a.href = `info.html?type=${encodeURIComponent(type)}&value=${encodeURIComponent(label)}`;
      li.appendChild(a);
      ul.appendChild(li);
    });
  }

  async function fetchAll(type) {
    const token = localStorage.getItem('token');
    const headers = token ? { 'Authorization': `Bearer ${token}` } : {};
    const res = await fetch(`${API_BASE}/${type}`, { headers });
    if (!res.ok) throw new Error(`Failed to load ${type}`);
    return res.json();
  }

  async function loadHome() {
    try {
      const [authors, texts, editions] = await Promise.all([
        fetchAll('authors'),
        fetchAll('texts'),
        fetchAll('editions')
      ]);
      populateList('authors-list', authors, 'authors', 'name');
      populateList('texts-list', texts, 'texts', 'title');
      populateList('editions-list', editions, 'editions', 'title');
      updateAuthUI();
    } catch (err) {
      console.error('Load error:', err);
      document.getElementById('content').innerHTML =
        `<p class="text-danger">Error loading data: ${err.message}</p>`;
    }
  }

  function updateAuthUI() {
    document.querySelectorAll('.create-btn').forEach(btn => {
      btn.style.display = localStorage.getItem('token') ? 'block' : 'none';
    });
  }

  window.addEventListener('DOMContentLoaded', () => {
    loadHome();
  });

  document.addEventListener('authChange', updateAuthUI);
</script>
</body>
</html>